{
  "name": "Application",
  "nodes": [
    {
      "parameters": {
        "sendTo": "iot@baoz.vn",
        "subject": "Y√™u c·∫ßu thu h·ªìi ƒë∆°n ngh·ªâ ph√©p",
        "message": "=<div style=\"font-family: Arial, sans-serif; line-height: 1.6; color: #333;\">\n  <h3 style=\"color: #ffc107;\">Y√™u C·∫ßu Thu H·ªìi ƒê∆°n Ngh·ªâ Ph√©p</h3>\n\n  <p>\n    <strong>{{ $json.body.adminName }}</strong> ƒë√£ y√™u c·∫ßu thu h·ªìi l·∫°i ƒë∆°n ngh·ªâ ph√©p c√≥ m√£ s·ªë \n    <strong>#{{ $json.body.leaveRequestId }}</strong>.\n  </p>\n\n  <p>H√†nh ƒë·ªông n√†y s·∫Ω ƒë∆∞a ƒë∆°n v·ªÅ tr·∫°ng th√°i <strong>\"Ch·ªù duy·ªát\"</strong> ƒë·ªÉ c√≥ th·ªÉ ch·ªânh s·ª≠a l·∫°i.</p>\n\n  <p>Vui l√≤ng nh·∫•n v√†o n√∫t b√™n d∆∞·ªõi ƒë·ªÉ x√°c nh·∫≠n vi·ªác thu h·ªìi ƒë∆°n:</p>\n\n  <div style=\"margin-top: 25px; text-align: center;\">\n    <a href=\"{{ $json.body.processRevocationLink }}\"\n       style=\"display: inline-block; padding: 12px 24px; background-color: #ffc107; color: black; text-decoration: none; border-radius: 5px; font-weight: bold;\">\n      X√°c Nh·∫≠n Thu H·ªìi\n    </a>\n  </div>\n</div>\n",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -16,
        224
      ],
      "id": "34ed1fad-34db-48fa-945d-189729c583f0",
      "name": "Email Revoke Confirmation",
      "webhookId": "1a781767-a797-4ebe-a93a-81a12b59475c",
      "credentials": {
        "gmailOAuth2": {
          "id": "etfAm2P8HNit6MF4",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "requestRevocation",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -240,
        224
      ],
      "id": "02e14ab1-1a0c-43c8-82c3-53e856c4daf5",
      "name": "Email Revoke Webhook",
      "webhookId": "4fb3f1c5-94d1-41b5-a7c0-6605725482ac"
    },
    {
      "parameters": {
        "sendTo": "iot@baoz.vn",
        "subject": "ƒê∆°n xin ngh·ªâ ph√©p",
        "message": "=<div style=\"font-family: Arial, sans-serif; line-height: 1.6; color: #333;\">\n  <h3 style=\"color: #0056b3;\">Y√™u C·∫ßu Duy·ªát ƒê∆°n Xin Ngh·ªâ Ph√©p</h3>\n  <p>Nh√¢n vi√™n <strong>{{ $json.body.employeeName }}</strong> ƒë√£ g·ª≠i m·ªôt y√™u c·∫ßu xin ngh·ªâ ph√©p v·ªõi c√°c th√¥ng tin sau:</p>\n\n  <table style=\"width: 100%; border-collapse: collapse; margin: 20px 0;\">\n    <tr>\n      <td style=\"padding: 8px; border: 1px solid #ddd; background-color: #f9f9f9; width: 120px;\"><strong>Lo·∫°i ph√©p:</strong></td>\n      <td style=\"padding: 8px; border: 1px solid #ddd;\">{{ $json.body.leaveType }}</td>\n    </tr>\n    <tr>\n      <td style=\"padding: 8px; border: 1px solid #ddd; background-color: #f9f9f9;\"><strong>T·ª´ ng√†y:</strong></td>\n      <td style=\"padding: 8px; border: 1px solid #ddd;\">{{ $json.body.fromDate }}</td>\n    </tr>\n    <tr>\n      <td style=\"padding: 8px; border: 1px solid #ddd; background-color: #f9f9f9;\"><strong>ƒê·∫øn ng√†y:</strong></td>\n      <td style=\"padding: 8px; border: 1px solid #ddd;\">{{ $json.body.toDate }}</td>\n    </tr>\n    <tr>\n      <td style=\"padding: 8px; border: 1px solid #ddd; background-color: #f9f9f9;\"><strong>T·ª´ gi·ªù:</strong></td>\n      <td style=\"padding: 8px; border: 1px solid #ddd;\">{{ $json.body.fromTime }}</td>\n    </tr>\n    <tr>\n      <td style=\"padding: 8px; border: 1px solid #ddd; background-color: #f9f9f9;\"><strong>ƒê·∫øn gi·ªù:</strong></td>\n      <td style=\"padding: 8px; border: 1px solid #ddd;\">{{ $json.body.toTime }}</td>\n    </tr>\n    <tr>\n      <td style=\"padding: 8px; border: 1px solid #ddd; background-color: #f9f9f9;\"><strong>L√Ω do:</strong></td>\n      <td style=\"padding: 8px; border: 1px solid #ddd;\">{{ $json.body.reason }}</td>\n    </tr>\n  </table>\n\n  <p>Vui l√≤ng xem x√©t v√† x·ª≠ l√Ω ƒë∆°n:</p>\n\n  <div style=\"margin-top: 25px; text-align: center;\">\n    <a href=\"{{ $json.body.approveLink }}\" style=\"display: inline-block; padding: 12px 24px; background-color: #28a745; color: white; text-decoration: none; border-radius: 5px; margin-right: 15px; font-weight: bold;\">\n      Duy·ªát ƒê∆°n\n    </a>\n    <a href=\"{{ $json.body.rejectLink }}\" style=\"display: inline-block; padding: 12px 24px; background-color: #dc3545; color: white; text-decoration: none; border-radius: 5px; font-weight: bold;\">\n      T·ª´ Ch·ªëi\n    </a>\n  </div>\n</div>\n",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        -16,
        0
      ],
      "id": "7d2aeea1-9474-48a1-98fd-cf42994b47ba",
      "name": "Email Approval Request",
      "webhookId": "1a781767-a797-4ebe-a93a-81a12b59475c",
      "credentials": {
        "gmailOAuth2": {
          "id": "etfAm2P8HNit6MF4",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "sendApproval",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -240,
        0
      ],
      "id": "e065725f-9435-4bc1-8792-46e4766cbc58",
      "name": "Get Send Approval Webhook",
      "webhookId": "4fb3f1c5-94d1-41b5-a7c0-6605725482ac"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "subscriptionUpdate",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -240,
        736
      ],
      "id": "08ab768b-cb3d-4b9b-aa95-b651910d4a12",
      "name": "Get Send Approval Subscription",
      "webhookId": "4fb3f1c5-94d1-41b5-a7c0-6605725482ac"
    },
    {
      "parameters": {
        "sendTo": "iot@baoz.vn",
        "subject": "Th√¥ng b√°o g√≥i d·ªãch v·ª•",
        "message": "=<div style=\"font-family: Arial, sans-serif; line-height: 1.6; color: #333;\">\n  <h3>Xin ch√†o,</h3>\n  <p>H·ªá th·ªëng ghi nh·∫≠n m·ªôt thay ƒë·ªïi v·ªÅ g√≥i d·ªãch v·ª•:</p>\n  <ul>\n    <li><strong>H√†nh ƒë·ªông:</strong> {{ $json.body.eventType === 'CREATE' ? 'Th√™m m·ªõi' : 'C·∫≠p nh·∫≠t' }}</li>\n    <li><strong>T√™n D·ªãch V·ª•:</strong> {{ $json.body.serviceName }}</li>\n    <li><strong>Nh√† Cung C·∫•p:</strong> {{ $json.body.provider }}</li>\n    <li><strong>Ng√†y H·∫øt H·∫°n:</strong> {{ $json.body.expiryDate }}</li>\n    <li><strong>Th·ªùi gian c√≤n l·∫°i:</strong> {{ $json.body.daysRemaining }} ng√†y</li>\n    <li><strong>Th·ª±c hi·ªán b·ªüi:</strong> {{ $json.body.triggeredBy }}</li>\n  </ul>\n  <p><em>ƒê√¢y l√† email t·ª± ƒë·ªông t·ª´ h·ªá th·ªëng qu·∫£n l√Ω.</em></p>\n</div>",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        208,
        448
      ],
      "id": "a6eabee4-62e3-47dd-81e4-457e2bf17bea",
      "name": "Email Approval Request Subscription",
      "webhookId": "1a781767-a797-4ebe-a93a-81a12b59475c",
      "credentials": {
        "gmailOAuth2": {
          "id": "etfAm2P8HNit6MF4",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.body.eventType.trim() }}",
                    "rightValue": "EXPIRING_SOON",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "24a62d9e-da79-4792-9c8d-957f24f4b744"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "=S·∫Øp h·∫øt h·∫°n"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        -16,
        736
      ],
      "id": "254ddcf0-1e80-4475-b128-f5902c3df30f",
      "name": "Switch"
    },
    {
      "parameters": {
        "sendTo": "iot@baoz.vn",
        "subject": "[C·∫¢NH B√ÅO] D·ªãch v·ª• {{ $json.body.serviceName }} s·∫Øp h·∫øt h·∫°n!",
        "message": "=<div style=\"font-family: Arial, sans-serif; line-height: 1.6; color: #c0392b;\">\n    <h3 style=\"color: #c0392b;\">C·∫£nh B√°o Gia H·∫°n D·ªãch V·ª•</h3>\n    <p>\n        D·ªãch v·ª• <strong>{{ $json.body.serviceName }}</strong> s·∫Ω h·∫øt h·∫°n trong \n        <strong>{{ $json.body.daysRemaining }} ng√†y</strong> n·ªØa.\n    </p>\n    <p>\n        <strong>Ng√†y h·∫øt h·∫°n:</strong> {{ $json.body.expiryDate }}\n    </p>\n    <p>Vui l√≤ng ti·∫øn h√†nh gia h·∫°n s·ªõm ƒë·ªÉ ƒë·∫£m b·∫£o d·ªãch v·ª• kh√¥ng b·ªã gi√°n ƒëo·∫°n.</p>\n    <p><em>Email ƒë∆∞·ª£c g·ª≠i t·ª± ƒë·ªông b·ªüi h·ªá th·ªëng gi√°m s√°t.</em></p>\n</div>",
        "options": {}
      },
      "type": "n8n-nodes-base.gmail",
      "typeVersion": 2.1,
      "position": [
        208,
        640
      ],
      "id": "ffd781bc-3cbb-43f3-b781-115ca171afc6",
      "name": "Email Approval Request Subscription EXPIRING SOON",
      "webhookId": "1a781767-a797-4ebe-a93a-81a12b59475c",
      "credentials": {
        "gmailOAuth2": {
          "id": "etfAm2P8HNit6MF4",
          "name": "Gmail account"
        }
      }
    },
    {
      "parameters": {
        "chatId": "=-4833884053",
        "text": "=*üì£ [C·∫¢NH B√ÅO D·ªäCH V·ª§]*\n\nD·ªãch v·ª•: `{{ $json.body.serviceName }}`\nNh√† cung c·∫•p: `{{ $json.body.provider }}`\n\n‚è≥ S·∫Ω h·∫øt h·∫°n trong: *{{ $json.body.daysRemaining }} ng√†y*\nüóìÔ∏è Ng√†y h·∫øt h·∫°n: *{{ $json.body.expiryDate }}*",
        "additionalFields": {
          "parse_mode": "MarkdownV2"
        }
      },
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1.2,
      "position": [
        208,
        832
      ],
      "id": "b9b8be1e-1e8c-4a32-aced-9665b90e2435",
      "name": "Send a text message",
      "webhookId": "080319e0-a670-42d4-8da0-f5a5bbabc295",
      "credentials": {
        "telegramApi": {
          "id": "znzNaqedmvTab4oa",
          "name": "Telegram account"
        }
      }
    }
  ],
  "pinData": {},
  "connections": {
    "Email Revoke Webhook": {
      "main": [
        [
          {
            "node": "Email Revoke Confirmation",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Send Approval Webhook": {
      "main": [
        [
          {
            "node": "Email Approval Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Get Send Approval Subscription": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "Email Approval Request Subscription EXPIRING SOON",
            "type": "main",
            "index": 0
          },
          {
            "node": "Email Approval Request Subscription",
            "type": "main",
            "index": 0
          },
          {
            "node": "Send a text message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Email Approval Request Subscription EXPIRING SOON": {
      "main": [
        []
      ]
    }
  },
  "active": true,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "8cbde2e5-e394-4882-b862-e8cfe69d224d",
  "meta": {
    "templateCredsSetupCompleted": true,
    "instanceId": "33b4dfdd72984394e10a4ce8a038f9c0ea654ccbfddb624fe7aae35ae3f75516"
  },
  "id": "4IeOdEFIOctb756Y",
  "tags": [
    {
      "createdAt": "2025-08-19T06:40:34.581Z",
      "updatedAt": "2025-08-19T06:40:34.581Z",
      "id": "HJeLA2gwzC2mlEgM",
      "name": "CRM"
    }
  ]
}